<!-- app/templates/home.html -->
{% extends 'base.html' %}

{% block content %}
{% with messages = get_flashed_messages(with_categories = True) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

  <h2 class="text-center mb-4">VibeStream</h2>

  {% if current_user.is_authenticated %}
  <div class="row">
    <div class="col-md-6 mb-3">
      <h2>Welcome, {{ current_user.username }}</h2>
    </div>

    <div class="col-md-6 mb-3">
      <div class="mb-3 text-end">
        <a href="{{ url_for('upload') }}" class="btn btn-success">Upload a New Video</a>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="row">
    {% for video in videos %}
      <div class="col-md-4 mb-3">
        <div class="card">
          <img class="card-img-top" src="{{ url_for('static', filename = '/images/thumbs/' + video.id|string + '.png') }}" alt="{{ video.title }}" onerror="this.src='https://picsum.photos/800/450'">
          <div class="card-body">
            <h5 class="card-title">{{ video.title }}</h5>
            <p class="card-text">Uploaded: {{ video.upload_date.strftime('%B %d, %Y') }}</p>
            <p class="card-text">{{ users[video.id] }}</p>
            <p class="card-text">Views: {{ video.watch_count }}</p>
            <a href="{{ url_for('stream_video', video_id=video.id) }}" class="btn btn-primary">Watch Video</a>
          </div>
        </div>
      </div>
    {% else %}
      <p>No videos available yet. Be the first to upload!</p>
    {% endfor %}
  </div>

{% endblock %}